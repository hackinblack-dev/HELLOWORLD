<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>For My Girl â¤ï¸</title>
    <link rel="stylesheet" href="style.css?v=3">
</head>

<body>
    <main class="stage" id="stage">
        <div class="particles" id="particles"></div>
        <div id="targetMarker" class="target-marker"></div>

        <header class="top-bar">
            <div class="top-left">
                <button class="top-btn" id="openHint" aria-label="Gifts">ğŸ</button>
                <button class="top-btn" id="openLetters" aria-label="Open When">ğŸ“‚</button>
            </div>

            <div class="stats-pill">
                <div class="stat-item s-pink"><small>From Her</small><span id="receivedDisplay">...</span></div>
                <div class="stat-item s-blue"><small>From Him</small><span id="sentDisplay">...</span></div>
            </div>

            <div class="top-right">
                <button class="top-btn" id="openGuestbook" aria-label="Guestbook">âœï¸</button>
                <button class="top-btn message-btn" id="openMessage" aria-label="Messages">
                    ğŸ’Œ
                    <span id="msgCounter" class="msg-counter"></span>
                </button>
            </div>
        </header>

        <section class="game-area">
            <div id="chaser" class="chaser face">ğŸ‘¨ğŸ»â€ğŸ’»</div>

            <div class="card" id="card">
                <h1>Hey beautiful!</h1>
                <p>Tap anywhere to call me.</p>
            </div>
        </section>

        <footer class="bottom-area">
            <div class="settings-menu" id="settingsMenu">
                <button class="menu-btn" id="toggleBoody">Mode: Chill</button>
                <button class="menu-btn purple-mode" id="toggleThreeAM">3 A.M. Mode ğŸ˜ˆ</button>
                <button class="menu-btn" id="toggleHearts">Hearts: OFF</button>
                <button class="menu-btn" id="randomize">Randomize Face</button>
                <small id="appVersion"
                    style="display:block; text-align:center; padding:5px; opacity:0.5; color:#888;">...</small>
            </div>

            <button class="settings-trigger" id="settingsTrigger" aria-label="Settings">âš™ï¸</button>

            <div class="send-row">
                <button class="big-btn" id="sendToHerBtn">Send to Her ğŸ’Œ</button>
                <button class="big-btn" id="sendToHimBtn">Send to Him ğŸ’‹</button>
            </div>
        </footer>

        <!-- Modals -->
        <div class="modal-box" id="hintBox" aria-hidden="true">
            <h2>ğŸ Love Coupons</h2>
            <ul class="hint-list">
                <li><strong>Free Hug ğŸ«‚</strong>Redeemable anytime!</li>
                <li><strong>Movie Night ğŸ¬</strong>You pick the movie.</li>
                <li><strong>Dinner Date ğŸ”</strong>My treat!</li>
            </ul>
            <button class="close-btn" id="closeHint">Yay! â¤ï¸</button>
        </div>

        <div class="modal-box" id="messageBox" aria-hidden="true">
            <h2>ğŸ’Œ New Message</h2>
            <div class="letter-content" id="letterText"></div>
            <button class="close-btn" id="closeMessage">Close</button>
        </div>

        <!-- Open When Menu -->
        <div class="modal-box" id="lettersBox" aria-hidden="true">
            <h2>ğŸ’Œ Open When You Are...</h2>
            <div class="mood-grid">
                <button class="mood-btn" data-mood="Sad ğŸ˜¢">Sad ğŸ˜¢</button>
                <button class="mood-btn" data-mood="Happy ğŸ¥³">Happy ğŸ¥³</button>
                <button class="mood-btn" data-mood="Miss You ğŸ¥º">Missing Me ğŸ¥º</button>
                <button class="mood-btn" data-mood="Mad ğŸ˜¡">Mad at Me ğŸ˜¡</button>
            </div>
            <button class="close-btn">Close</button>
        </div>

        <!-- Individual Letter View -->
        <div class="modal-box" id="letterViewBox" aria-hidden="true">
            <h2>ğŸ“ For You</h2>
            <div class="letter-content" id="letterContent"></div>
            <button class="close-btn">Close</button>
        </div>

        <!-- Guestbook -->
        <div class="modal-box" id="guestbookBox" aria-hidden="true">
            <h2>ğŸ“ Leave a Message</h2>
            <textarea id="guestbookInput" placeholder="Write something sweet..."></textarea>

            <!-- Doodle Launcher -->
            <div class="doodle-launcher" id="doodleLauncher">
                <div id="doodlePlaceholder" class="doodle-placeholder">
                    <span>ğŸ¨</span>
                    <p>Tap to Draw</p>
                </div>
                <img id="doodleThumbnail" class="doodle-thumbnail" aria-hidden="true" />
                <div class="launcher-controls">
                    <button type="button" id="btnEditDoodle" class="edit-doodle-btn">Edit</button>
                    <button type="button" id="btnDeleteDoodle" class="delete-doodle-btn">ğŸ—‘ï¸</button>
                </div>
            </div>

            <button class="action-btn" id="sendNoteBtn">Send to Him ğŸš€</button>
            <button class="close-btn">Cancel</button>
        </div>

        <div id="tipToast" class="tip-toast">Remember to drink water! ğŸ’§</div>
    </main>

    <!-- Fullscreen Doodle Editor (Hidden by default) -->
    <div class="doodle-overlay hidden" id="doodleOverlay">
        <div class="doodle-toolbar" id="doodleToolbar">
            <button id="toggleTools" class="tool-btn" title="Minimize/Expand">ğŸ”½</button>
            <div class="tool-group">
                <button id="doneDoodle" class="done-btn">âœ… Done</button>
            </div>
            <div class="tool-group">
                <input type="color" id="penColor" value="#e91e63">
                <div class="presets">
                    <button class="color-preset" style="background:#e91e63" data-color="#e91e63"></button>
                    <button class="color-preset" style="background:#0f172a" data-color="#0f172a"></button>
                    <button class="color-preset" style="background:#ffffff" data-color="#ffffff"></button>
                </div>
            </div>
            <div class="tool-group">
                <button id="sizeMinus" class="tool-btn">â–</button>
                <button id="sizePlus" class="tool-btn">â•</button>
            </div>
            <div class="tool-group">
                <input type="color" id="bgColor" value="#ffffff" title="Background">
            </div>
            <div class="tool-group">
                <input type="file" id="imgUpload" accept="image/*" style="display:none">
                <button id="btnUpload" class="tool-btn" title="Add Photo">ğŸ“·</button>
                <button id="btnMove" class="tool-btn" title="Move/Resize Photo" style="display:none">âœ‹</button>
            </div>
            <button id="clearDoodle" class="tool-btn">ğŸ—‘ï¸</button>
        </div>
        <div id="doodleContainer" class="doodle-container">
            <img id="doodleImg" class="doodle-img" src="" alt="">
            <canvas id="doodleCanvas"></canvas>
        </div>
    </div>

    <script>
        // Dynamic Script Loader to bypass cache automatically
        (function () {
            var timestamp = Date.now();
            fetch('version.json?t=' + timestamp)
                .then(r => r.json())
                .then(data => {
                    var v = data.version;
                    var script = document.createElement('script');
                    script.type = 'module';
                    script.src = 'script.js?v=' + v; // Always matches server version
                    document.body.appendChild(script);
                })
                .catch(e => {
                    // Fallback if version.json fails
                    var script = document.createElement('script');
                    script.type = 'module';
                    script.src = 'script.js?v=' + timestamp;
                    document.body.appendChild(script);
                });
        })();
    </script>
</body>

</html>